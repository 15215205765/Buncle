{include file="public/left_nav" /}
<div class="layui-body" style="background-color:#f2f2f2">
    <div style="padding: 10px 0 0px 15px;">
      
        <a style="float: left;margin-right: 10px;" class="layui-btn  btn-chouj layui-btn-sm layui-btn-normal" href="__APP__/admin/goods/index" style="color:#1781ed">商品列表</a>
       
        <!-- <button style="float: left;margin-right: 10px;" class="layui-btn btn-chouj-choose layui-btn-sm layui-btn-normal">
        <a href="__APP__/admin/prize/add" style="color:#fff">添加奖品</a>
        </button> -->
    </div>
    <div style="padding: 10px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">添加APP</div>
                    <div class="layui-card-body">
                        <form class="layui-form" action="">
                          
                            <div class="layui-form-item">
                                <label class="layui-form-label">APP名称：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="title" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['title']}">
                                </div>
                            </div>
                            
                            <div class="layui-form-item">
                                <label class="layui-form-label">描述：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="short_title" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['short_title']}">
                                </div>
                            </div>
                          
                           
                            <div class="layui-form-item">
                                <label class="layui-form-label">APPlogo：</label>
                                <div class="layui-upload">
                                    <button type="button" class="layui-btn" id="test1" style="background-color:#ddd;color:#333">选择图片</button>
                                    <div class="layui-upload-list" id="demo1" style="margin: 10px 105px;"> 
                                   
                                    <img class="layui-upload-img"  src="__PUBLIC__/uploads/{$data['logo']}" style="width:80px;height:50px">
                                  
                                    <!-- <p style="color:#999;font-size:12px">*建议图片宽高80*50</p> -->
                                        <p id="demoText"></p>
                                    </div>
                                </div>
                            </div>
                            
                             <div class="layui-form-item">
                                <label class="layui-form-label">BANNER：</label>
                                <div class="layui-upload">
                                    <button type="button" class="layui-btn" id="test2" style="background-color:#ddd;color:#333">选择图片</button>
                                    <div class="layui-upload-list" id="demo2" style="margin: 10px 105px;"> 
                                   
                                    <img class="layui-upload-img"  src="__PUBLIC__/uploads/{$data['thumb']}" style="width:80px;height:50px">
                                  
                                    <!-- <p style="color:#999;font-size:12px">*建议图片宽高80*50</p> -->
                                        <p id="demoText"></p>
                                    </div>
                                </div>
                            </div>
                             <div class="layui-form-item">
                                <label class="layui-form-label">IOS下载地址：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="ios" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['ios']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">安卓下载地址：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="android" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['android']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">官方地址：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="url" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['url']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">简介：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="content" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['content']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">APP类型：</label>
                                <div class="layui-input-inline">
                                   <select name="quiz" id="agent" style="long-input">
                                      <option value="1" >交易所</option>
                                      <option value="2">资讯媒体</option>
                                      <option value="3">钱包应用</option>
                                      <option value="4">项目应用</option>
                                  </select>
                                </div>
                            </div>
                             <div class="layui-form-item">
                                <label class="layui-form-label">APP排序：</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="title" id="scok" lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['sock']}">
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">是否显示</label>
                                <div class="layui-input-block">
                                  <input type="radio" name="is_show" value="1" title="是" <?php if($data['is_show']==1){echo 'checked';}?>>
                                  <input type="radio" name="is_show" value="0" title="否" <?php if($data['is_show']==0){echo 'checked';}?>>
                                </div>
                              </div>
                              <div class="layui-form-item">
                                <label class="layui-form-label">是否热门</label>
                                <div class="layui-input-block">
                                  <input type="radio" name="is_hot" value="1" title="是" <?php if($data['is_hot']==1){echo 'checked';}?>>
                                  <input type="radio" name="is_hot" value="0" title="否" <?php if($data['is_hot']==0){echo 'checked';}?>>
                                </div>
                              </div>
                               <div class="layui-form-item">
                                <label class="layui-form-label">是否最新</label>
                                <div class="layui-input-block">
                                  <input type="radio" name="is_recommend" value="1" title="是" <?php if($data['is_recommend']==1){echo 'checked';}?>>
                                  <input type="radio" name="is_recommend" value="0" title="否" <?php if($data['is_recommend']==0){echo 'checked';}?>>
                                </div>
                              </div>
                              {notempty name="data['wetch']"}
                                 <div class="layui-form-item">
                                    <label class="layui-form-label">微信：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="title"  lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['wetch']}">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                  <label class="layui-form-label">是否赞助</label>
                                  <div class="layui-input-block">
                                    <input type="radio"  value="1" title="是" <?php if($data['zanzhu']==1){echo 'checked';}?>>
                                    <input type="radio"  value="0" title="否" <?php if($data['zanzhu']==0){echo 'checked';}?>>
                                  </div>
                                </div>
                                {if $data['zanzhu']==1}
                                  <div class="layui-form-item">
                                    <label class="layui-form-label">赞助类容：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="title"  lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['zanzhu_con']}">
                                    </div>
                                  </div>
                                   <div class="layui-form-item">
                                    <label class="layui-form-label">赞助数量：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" name="title"  lay-verify="title" autocomplete="off" placeholder="请点击输入" class="layui-input long-input" value="{$data['zanzhu_num']}">
                                    </div>
                                  </div>
                                {/if}
                              {/notempty}
                            <div class="layui-form-item">
                                <div class="layui-input-block">
                                    <div class="layui-btn site-demo-layedit btn-chouj-choose" id="submit">提交</div>
                                   <input type="hidden" id="id" value="{$data['id']}" name="">
                                    <a class="layui-btn layui-btn-primary" href="__APP__/admin/app/index">返回</a>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body></html><style>
.tishitiao {
	background-color: #ff794e;
	color: #fff;
	border-left: none;
	line-height: 3px;
}
.layui-layer-content {
	padding: 20px 0;
	text-align: center;
}
.layui-layer-molv .layui-layer-title {
	color: #009f95
}
.layui-laydate .layui-this {
	background-color: #4f76eb!important;
	color: #fff!important;
}
.btn-chouj-choose {
	border-radius: 3px;
	background-color: #1781ed;
	color: #fff;
}
.btn-chouj {
	border-radius: 5px;
	background-color: #fff;
	color: #1781ed;
	border: 1px solid #1781ed;
}
</style>
<script type="text/javascript">
var imgs='{$data['logo']}';
var thumb='{$data['thumb']}';

layui.use(['form', 'layedit', 'laydate','upload'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;
    var $ = layui.jquery
  ,upload = layui.upload;
 var uploadInst = upload.render({
    elem: '#test1'
    ,url: '__APP__/admin/base/uploadimg'
    , multiple:true
    ,number:1
    ,before: function(obj){
      //预读本地文件示例，不支持ie8
      // obj.preview(function(index, file, result){
      //   $('#demo1').attr('src', result); //图片链接（base64）
      // });
    }
    ,done: function(res){
      //如果上传失败
      if(res.code==0){
       
        var img = '<img src="__PUBLIC__/uploads/'+res.url+'" style="width:80px;height:50px">';
        $('#demo1').html(img);
        imgs=res.url;
        console.log(img);
      }
      if(res.code > 0){
        return layer.msg(res.msg);
      }
      //上传成功
    }
    ,error: function(){
      //演示失败状态，并实现重传
      var demoText = $('#demoText');
      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
      demoText.find('.demo-reload').on('click', function(){
        uploadInst.upload();
      });
    }
  });
  var uploadIns = upload.render({
    elem: '#test2'
    ,url: '__APP__/admin/base/uploadimg'
    , multiple:true
    ,number:1
    ,before: function(obj){
      //预读本地文件示例，不支持ie8
      // obj.preview(function(index, file, result){
      //   $('#demo1').attr('src', result); //图片链接（base64）
      // });
    }
    ,done: function(res){
      //如果上传失败
      if(res.code==0){
       
        var img = '<img src="__PUBLIC__/uploads/'+res.url+'" style="width:80px;height:50px">';
        $('#demo2').html(img);
        thumb=res.url;
        console.log(img);
      }
      if(res.code > 0){
        return layer.msg(res.msg);
      }
      //上传成功
    }
    ,error: function(){
      //演示失败状态，并实现重传
      var demoText = $('#demoText');
      demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
      demoText.find('.demo-reload').on('click', function(){
        uploadInst.upload();
      });
    }
  });

 $('#submit').click(function(){
  
  var title = $('#title').val();
  var scok = $('#scok').val();
 var ios = $('#ios').val();
  var url = $('#url').val();
  var content = $('#content').val();
  var id = $('#id').val();
  var agent = $('#agent').val();
  var android = $('#android').val(); 
  var is_show = $("input[name='is_show']:checked").val();
  var is_hot = $("input[name='is_hot']:checked").val();
  var is_recommend = $("input[name='is_recommend']:checked").val();
  var short_title = $('#short_title').val();
  var id =$('#id').val();
  var load = layer.load(1);
  $.ajax({
    url:'__APP__/admin/app/addapp',
    type:'post',
    dataType:'json',
    data:{
      title:title,
      logo:imgs,
      ios:ios,
      thumb,thumb,
      android:android,
      sock:scok,
      url:url,
      short_title:short_title,
      id:id,
      content:content,
      agent:agent,
      is_recommend:is_recommend,
      is_hot:is_hot,
      is_show:is_show
     
    },success:function(res){
      layer.close(load);
        if(res.code==0){
           layer.open({
              type: 1,
              title: '提示',
              icon: 1,
              content: '添加成功',
              time:2000 ,
              skin: 'layui-layer-molv',
              closeBtn: 0,
              area: ['300px', '150px'],
              end:function(){
                window.location.href= '__APP__/admin/app/index';
              }
            });
        }else if(res.code==2){
            layer.msg(res.msg);
        }else{
           layer.open({
              type: 1,
              title: '提示',
              icon: 1,
              content: '添加失败',
              time:2000 ,
              skin: 'layui-layer-molv',
              closeBtn: 0,
              area: ['300px', '150px'],
              end:function(){
               // window.location.href=location;
              }
            });
        }
    }
  })
})
  //监听提交
  form.on('submit(demo1)', function(){
layer.open({
  type: 1,
  skin: 'layui-layer-molv',
  closeBtn: 0, 
  anim: 2,
  area: ['300px', '150px'],
  shadeClose: false, 
  content: '加载中，请耐心等待...',
  title:' ',
  time:2000 ,
   end: function(){
    layer.open({
      type: 1,
      title: ' ',
	  icon: 1,
      content: '添加成功',
	  time:2000 ,
	   skin: 'layui-layer-molv',
       closeBtn: 0,
	   area: ['300px', '150px'],
    });
  }
});

    /*layer.alert(JSON.stringify(data.field), {
      title: '最终的提交信息'
    })*/
    return false;
  });
});
</script>