{include file="public/left_nav" /}
<style type="text/css">
    table{
   
    table-layout:fixed;/* 只有定义了表格的布局算法为fixed，下面td的定义才能起作用。 */
}
td{
    width:100%;
    word-break:keep-all;/* 不换行 */
    white-space:nowrap;/* 不换行 */
    overflow:hidden;/* 内容超出宽度时隐藏超出部分的内容 */
    text-overflow:ellipsis;/* 当对象内文本溢出时显示省略标记(...) ；需与overflow:hidden;一起使用。*/
}

</style>
<div class="layui-body" style="background-color:#f2f2f2">
    <div style="padding: 10px; background-color: #F2F2F2;">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-body">
                        <div class="layui-form">
                            <table class="layui-table" style="table-layout:fixed;" id="test" lay-filter="test">
                            <thead>
                            	<th style="width:30px;">id</th>
                            	<th>身份号</th>
                            	<th>UNCLE</th>
                            	<th  style="width:100px;">MBTC</th>
                            	<th style="width:50px;">状态</th>
                            	<th>上传时间</th>
                                <th>操作</th>
                            </thead>
                            <tbody>
                            {volist name='list' id='item'}
                            <tr>
                            	<td>{$item['id']}</td>
                            	<td>{$item['idcard']}</td>
                            	<td>{$item['number']}</td>
                            	<td>{$item['number']/10000}</td>
                                <td>
                                    {switch name="$item['statu']"}
                                     {case value="0"}
                                           未发放
                                        {/case}
                                       {case value="2"}
                                        已拒绝
                                         {/case}
                                        {default /}
                                           已发放
                                    {/switch}
                            	<td>{$item['createtime']|date="Y-m-d H:i",###}</td>
                                
                                <td>
                                    {switch name="$item['statu']"}
                                        {case value="0"}
                                           <button href="__APP__/admin/app/add?id={$item['id']}" class="layui-btn tongguo"  data-id="{$item['id']}">发放</button>
                                           <button href="__APP__/admin/app/add?id={$item['id']}" class="layui-btn jujue"  data-id="{$item['id']}">拒绝</button>
                                        </div>
                                        {/case}
                                         {case value="2"}
                                         <button class="layui-btn layui-btn-primary">已拒绝</button>
                                         {/case}
                                        {default /}
                                       <button class="layui-btn layui-btn-primary">已发放</button>
                                    {/switch}
                                
                            </tr>
                            {/volist}
                            </tbody>
                            </table>
                            {$list->render()}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

        $('.tongguo').each(function(){
        $(this).click(function(){
            var id = $(this).attr('data-id');
            layer.confirm('确认发放吗？', {
              btn: ['确定', '取消'] //可以无限个按钮
              
            }, function(index, layero){
                $.ajax({
                    url:'__APP__/admin/mbtc/tongguo',
                    type:'post',
                    dataType:'json',
                    data:{
                        id:id
                    },
                    success:function(res){
                        layer.close(index);
                        if(res.code==0){
                            layer.msg('操作成功',{shift:-1},function(){
                                window.location.href=location;
                            })
                        }else{
                            layer.msg('操作失败');
                        }
                    }
                })
            }, function(index){
              layer.close(index);
            });
        })
    })
    $('.jujue').each(function(){
        $(this).click(function(){
            var id = $(this).attr('data-id');
            layer.confirm('确认拒绝吗？', {
              btn: ['确定', '取消'] //可以无限个按钮
              
            }, function(index, layero){
                $.ajax({
                    url:'__APP__/admin/mbtc/jujue',
                    type:'post',
                    dataType:'json',
                    data:{
                        id:id
                    },
                    success:function(res){
                        layer.close(index);
                        if(res.code==0){
                            layer.msg('操作成功',{shift:-1},function(){
                                window.location.href=location;
                            })
                        }else{
                            layer.msg('操作失败');
                        }
                    }
                })
            }, function(index){
              layer.close(index);
            });
        })
    })
    layui.use(['form', 'layedit', 'laydate','upload'], function(){
  var form = layui.form
  ,layer = layui.layer
  ,layedit = layui.layedit
  ,laydate = layui.laydate;
    var $ = layui.jquery
  ,upload = layui.upload;
})
</script>