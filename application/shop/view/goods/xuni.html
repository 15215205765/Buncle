<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"  />
<title>商品详情页</title>
<link href="/shop/css/details_xuni.css" type="text/css" rel="stylesheet">
<script src="/shop/js/jquery-2.1.1.min.js" type="text/javascript"></script>
<script src="/shop/js/focus.js" type="text/javascript"></script>
	<link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css">
	<script src="__PUBLIC__/layer/layer.js"></script> 
</head>

<body>
	<!--产品图片-->
	<div class="pro_img"><img src="__PUBLIC__/uploads/{$data['thumb']}"></div>
	<!--产品标题-->
	<div class="pro_txt">
		<h3>{$data['title']}</h3>
		<p>总量{$data['stock']}个兑完即止，目前剩余{$data['stock']-$data['sold']}个</p>
		<div class="txt_title">
			{if $data['price']>0}
			&yen;
			<span>{$data['price']}元</span>
			{/if}
			{if $data['price']>0 && $data['uncle']>0}+{/if}
			{if $data['uncle']>0}
			
			<span>{$data['uncle']}UNCLE</span>
			{/if}
		</div>
	</div>
	<div class="box_number">
		<input type="tel" maxlength="11" alt="请输入腾讯视频账户（手机号）" id="remake" placeholder="请输入腾讯视频账户（手机号）">
		<div class="btn_shop" id="buy">立即购买</div>
	</div>
	
	<!--购买须知-->
	<div class="txt_do">
		<i></i>
		<p>兑换前请务必核对账户是否正确，本产品为虚拟产品，<br>一经售出充值成功，概不退还。<br>最终解释权归BUNCLE所有。</p>
	</div>
	<!--提交订单-->
	<div class="box_order">
		<div class="order_pox">
			<h3>恭喜您 购买成功</h3>
			<!-- <p>已扣除<span>999</span> UNCLE 您还剩余<span>1299</span> UNCLE</p> -->
			<a href="__APP__/shop/order/xuni" class="cha_btn">查看订单</a>
			<div class="del_btn"></div>
		</div>
	</div>
</body>
<script>
	//获取屏幕宽度；
	windWid();
	function windWid(){
		var w=$('body').width();
		$("html").css({"font-size":(w/10)+'px'});
	}
	//监听窗口变化
	$(window).resize(function(){
		windWid();
	});
	
	
	//点击查看订单
	// $('.btn_shop').click(function(){
	// 		$('.box_order').show();
	// });
	// $('.del_btn').click(function(){
	// 	$('.box_order').hide();
	// });
	$('#buy').click(function(){
		var remake = $('#remake').val();
		if(remake==''){
			layer.msg('请输入腾讯视频账户（手机号）');
			return false;
		}
		var load = layer.load(1);
		$.ajax({
			url:'__APP__/shop/order/create1',
			type:'post',
			dataType:'json',
			data:{
				remake:remake,
				gid:{$data['id']}
			},
			success:function(res){
				if(res.code==0){
					layer.close(load);
					layer.msg('购买成功',{shift:-1},function(){
						$('.box_order').show();
					});
				}else if(res.code==1){
					layer.close(load);
					layer.msg('购买失败，请稍后再试');
				}else{
					WeixinJSBridge.invoke(
                    'getBrandWCPayRequest',
                    res,
                    function(res){
                        WeixinJSBridge.log(res.err_msg);
                        if(res.err_msg == "get_brand_wcpay_request:ok"){
                            layer.msg('支付成功');
                            window.location.href=location;
                        }else{
                            layer.msg('支付失败');
                              
                        }
                        //layer.msg(res.err_code+res.err_desc+res.err_msg);
                    }
                );
				}
			}
		})
	})
</script>
</html>
