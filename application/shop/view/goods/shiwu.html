<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"  />
<title>商品详情页</title>
<link href="/shop/css/details_shiwu.css" type="text/css" rel="stylesheet">
<script src="/shop/js/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="__PUBLIC__/layui/layui.js"></script> <script type="text/javascript" src='https://res.wx.qq.com/open/js/jweixin-1.2.0.js'></script> 
<script src="/shop/js/jquery.mobile-1.2.1.min.js" type="text/javascript"></script>
	<link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css">
	<script src="__PUBLIC__/layer/layer.js"></script> 
</head>

<body>
	<!--产品图片-->
	<div id="banner" class="banner">
		<ul>{volist name="data['banner']" id="item"}<li><a href="###"><img src="__PUBLIC__/uploads/{$item}"></a></li>{/volist}</ul>
		<ol>{volist name="data['banner']" id="item"}<li></li>{/volist}</ol>
	</div>
	<!--产品标题-->
	<div class="pro_txt">
		<p>{$data['title']}</p>
		<div class="txt_title">
		{if $data['price']>0}
			&yen;
			<span>{$data['price']}元</span>
			<b>{$data['oldprice']}元</b>
			{/if}
			{if $data['price']>0 && $data['uncle']>0}+{/if}
			{if $data['uncle']>0}
			
			<span>{$data['uncle']}UNCLE</span>
			{/if}
			<!-- ￥
			<span>106元</span>
			<b>120元</b>
			<a href="">BUNCLE专享</a> -->
		</div>
	</div>
	<!--购买数量和地址-->
	<div class="box_number">
		<div class="poc">
			<h4>已选</h4>
			<div class="poc_box">
				<div class="btn_jian">-</div>
				<span><p>1</p>件</span>
				<div class="btn_jia">+</div>
			</div>
		</div>
		<div style="width: 7.4rem;height: 0.01rem;background: #c0c0c0;float: right;margin-right: 0.7rem"></div>
		<div class="poc">
			<h4>地址</h4>
			<div class="poc_box">
				<i></i>
				<a href="__APP__/shop/address?gid={$data['id']}">{$address['province']}{$address['city']}{$address['area']}{$address['detail']}</a>
			</div>
		</div>
	</div>
	<!--图文详情-->
	<div class="deta_xiangqin">
		<!-- {$data['content']} -->
	</div>
	<!--购买须知-->
	<div class="txt_do">
		<i></i>
		<p>兑此商品不支持退货，图文详情商品图片仅作为参考，<br>具体商品以实物为准。<br>最终解释权归BUNCLE所有。</p>
		<div class="btn_shop" id="buy">立即购买</div>
	</div>
	<!--提交订单-->
	<div class="box_order">
		
		<div class="order_pox">
			<h3>恭喜您 购买成功</h3>
			<a href="__APP__/shop/order/all" class="cha_btn">查看订单</a>
			<div class="del_btn"></div>
		</div>
	</div>
</body>
<script>
	//获取屏幕宽度；
	windWid();
	function windWid(){
		var w=$('body').width();
		$("html").css({"font-size":(w/10)+'px'});
	}
	//监听窗口变化
	$(window).resize(function(){
		windWid();
	});
	
	//动态添加banner；
	var num=0;
	var winW=$('body').width()/10;
	//var bannerArry=['img/loglist/prod_img_01.png','img/loglist/prod_img_01.png','img/loglist/prod_img_01.png'];
	// for(var i=0;i<bannerArry.length;i++){
	// 	$('#banner ul').append('<li><a href="###"><img src="'+bannerArry[i]+'"></a></li>');
	// 	$('#banner ol').append('<li></li>');
	// }
	// var img_W=$('#banner ul li').eq(0).width();
	// var clone=$('#banner ul li').eq(0).clone();//克隆第一个banner
	// $('#banner ul').append(clone);
	// var leng=$('#banner ul li').length;
	// $('#banner ul').width(img_W*leng+winW);
	// $('#banner ol li').eq(0).css('background','#0166fe');
	// // $('#banner ol').width((bannerArry.length+1)*(winW*0.38)).css({
	// // 	'margin-left':-(winW-winW*0.38)/2,
	// // });
	// $("#banner").on("swiperight",function(){
	// 	moveL();
	// });
	// $("#banner").on("swipeleft",function(){
	// 	moveR();
	// });
	// function moveR(){ //向滑动切换轮播图函数
	// 	num++;
	// 	if(num>bannerArry.length){
	// 		num=1;
	// 		$('#banner ul').css('left',0);
	// 	}else if(num===bannerArry.length){
	// 		$('#banner ol li').eq(0).css('background','#0166fe').siblings().css('background','#e1e1e1');
	// 	}
	// 	$('#banner ul').stop().animate({'left':-num*(winW*10)},300);
	// 	$('#banner ol li').eq(num).css('background','#0166fe').siblings().css('background','#e1e1e1');
	// }
	// function moveL(){   //向左滑动换轮播图函数
	// 	num--; 
	// 	if(num===-1){
	// 		$('#banner ul').css('left',-(bannerArry.length)*(winW*10));
	// 		num=bannerArry.length-1;
	// 	}
	// 	$('#banner ul').stop().animate({'left':-num*(winW*10)},300);
	// 	$('#banner ol li').eq(num).css('background','#0166fe').siblings().css('background','#e1e1e1');
	// 	//$('#banner ol li').eq(num).addClass('key').siblings().removeClass('key');
	// }
	// var t=setInterval(moveR,3000);  //自动轮播函数
	// $("#banner").swipe(function(){   
	// 	clearInterval(t);
	// });
	
	// t=setInterval(moveR,3000);
	
	//点击加减增减商品数量
	var txtNum=Number($('.poc_box p').text());
	$('.btn_jian').click(function(){
		txtNum--;
		if(txtNum===0){
			$('.btn_jian').unbind().css('color','#999');
		}
		$('.poc_box p').text(txtNum);
	});
	$('.btn_jia').click(function(){
		txtNum++;
		$('.poc_box p').text(txtNum);
		if(txtNum>0){
			$('.btn_jian').bind('click').css('color','#000');
		}
		
	});
	
	// $(function(){
	// 	//点击查看订单
	// 	$('.btn_shop').click(function(){
	// 			$('.box_order').show();
	// 	});
	// 	$('.del_btn').click(function(){
	// 		$('.box_order').hide();
	// 	});
	// });

	$('#buy').click(function(){
		var load = layer.load(1);
		$.ajax({
			url:'__APP__/shop/order/create',
			type:'post',
			dataType:'json',
			data:{
				gid:{$data['id']},
				aid:{$address['id']},
				number:txtNum
			},
			success:function(res){
				if(res.code==0){
					layer.close(load);
					layer.msg('购买成功',{shift:-1},function(){
						$('.box_order').show();
					});
				}else if(res.code==1){
					layer.close(load);
					layer.msg('购买失败，请稍后再试');
				}else{
					WeixinJSBridge.invoke(
                    'getBrandWCPayRequest',
                    res,
                    function(res){
                        WeixinJSBridge.log(res.err_msg);
                        if(res.err_msg == "get_brand_wcpay_request:ok"){
                            layer.msg('支付成功');
                            $('.box_order').show();
                        }else{
                            layer.msg('支付失败');
                              
                        }
                        //layer.msg(res.err_code+res.err_desc+res.err_msg);
                    }
                );
				}
			}
		})
	})
</script>
</html>
